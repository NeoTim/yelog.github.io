<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>时间管理</title>
    <link rel="icon" href="/img/avatar.jpg">
</head>
<body>
<style>
    #data{
        height: 200px;
        width: 170px;
    }
    .button {
        background-color: #008CBA;
        border: none;
        color: white;
        padding: 5px 11px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        border-radius: 5px;
    }
</style>
<textarea id="data">
第5组 易效能100天践行20180112（9/100 ）
全员完成时间
41.Melissa  5:02
42.谢惠丹6:46
43.三    两6:25
44.杨玉杰6:18
45.李    雯6:47
47.郝欣欣7:40
48.苗婷婷5:42
49.苗强强6:20
50.邹凤霞7:03
76.穆    婧5:55
加分项+1

第5组 易效能100天践行20180111（8/100 ）
全员完成时间
41.Melissa  5:10
42.谢惠丹7:00
43.三    两6:52
44.杨玉杰6:02
45.李    雯7:20
47.郝欣欣5:52
48.苗婷婷5:52
49.苗强强6:20
50.邹凤霞6:55
76.穆    婧6:09
加分项+2

第5组 易效能100天践行20180110（7/100 ）
全员完成时间
41.Melissa  5:03
42.谢惠丹6:47
43.三    两6:49
44.杨玉杰7:15
45.李    雯6:51
47.郝欣欣6:59
48.苗婷婷5:51
49.苗强强5:59
50.邹凤霞6:56
76.穆    婧5:04
加分项 +2

第5组 易效能100天践行20180109（6/100 ）
全员完成时间
41.Melissa  5:16
42.谢惠丹7:00
43.三    两 6:30
44.杨玉杰 6:02
45.李    雯6:55
47.郝欣欣7:07
48.苗婷婷 5:46
49.苗强强6:18
50.邹凤霞7:00
76.穆    婧5:59
加分项 +2


第5组 易效能100天践行20180108（5/100 ）
全员完成时间
41.Melissa  5:22
42.谢惠丹7:02
43.三    两 5:54
44.杨玉杰 6:01
45.李    雯6:19
47.郝欣欣7:21
48.苗婷婷5:24
49.苗强强6:20
50.邹凤霞6:55
76.穆    婧5:40
加分项 +2
</textarea>
<button id="" class="button" onclick="resolve()">解析</button>
<hr>
<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
<div id="main" style="width: 600px;height:400px;"></div>
<script src="js/jquery.min.js" ></script>
<script src="js/echarts.common.min.js" ></script>
<script>
    resolve();
    function resolve() {
        var userData = {};
        var datex = [];
        var dayDatas = $('#data').val().split('易效能100天践行');
        var yearDate = "";
        for (var i=1;i<dayDatas.length;i++) {
            var dayData = dayDatas[i];
            yearDate = dayData.substr(0,dayData.indexOf("（"))
            datex.push(yearDate);
            var dataLineReg =/^\d+/;
            var dateReg = /\d+:\d+/;
            $.each(dayData.split("全员完成时间")[1].split("\n"), function () {
                if (dataLineReg.test(this)) {
                    var name = this.replace(dateReg,"").replace(/\s+/g, "");
                    var user = typeof userData[name] == 'undefined' ? {} : userData[name];
                    if (typeof user.data == 'undefined') {
                        user.data = [];
                    }
                    var date = this.match(dateReg)[0].split(":");
                    user.data.push({date: yearDate,value: parseInt(date[0]*60)+parseInt(date[1])});
                    userData[name] = user;
                }
            })
        }
        var keys = [];
        var values = [];
        $.each(userData, function (key, value) {
            keys.push(key);
            value.name=key;
            value.type='line'
            var data = value.data.sort(function (a, b) { return a.date - b.date })
            value.data = [];
            data.forEach(function (item) {
               value.data.push(item.value);
            })

            values.push(value)
        });
        var datex2 = [];
        $.each(datex.sort(function (a, b) { return a-b; }), function (item, that) {
            datex2.push(that.substring(4,6)+'月'+that.substring(6)+'日');
        })
        init(keys, values, datex2, yearDate.substring(0,4)+'易效能'+dayDatas[0].substring(1).trim()+'打卡情况');

    }
    function init(keys, values, datex, title) {

        $('#main').attr('_echarts_instance_','')

        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));


        // 指定图表的配置项和数据
        var option = {
            title: {
                text: title,
                x:'center',
                y: 'bottom'
            },
            radius : '100%',
            tooltip : {
                trigger: 'axis',
                formatter:function (params) {
                    var result = "";
                    params.sort(function (a, b) { return a.data-b.data }).forEach(function (item) {
                        var value = item.value;
                        var h = parseInt(value / 60);
                        var m = parseInt(value % 60);
                        if (h < 0 || h > 24)
                            return "";
                        if (m < 10){
                            m = '0' + m;
                        }
                        value = h + ':' + m;
                        result += '<span style="display:inline-block;margin-right:5px;border-radius:10px;width:9px;height:9px;background-color:' + item.color + '"></span>';
                        result += item.seriesName+":"+value+"<br/>";
                    })
                    return result;
                }
            },
            legend: {
                data:keys,
            },
            toolbox: {
                feature: {
                    saveAsImage: {title: '保存'}
                }
            },
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : datex
                }
            ],
            yAxis : [
                {
                    type : '',
                    inverse: true,
                    min: function(value) {
                        return value.min - 20;
                    },
                    axisLabel : {
                        formatter: function (value) {
                            var h = parseInt(value / 60);
                            var m = parseInt(value % 60);
                            if (h < 0 || h > 24)
                                return "";
                            if (m < 10){
                                m = '0' + m;
                            }
                            return h + ':' + m;
                        }
                    }
                }
            ],
            series : values
        };


        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);

    }
    $(function () {
        // var keys =["one","two"];
        // var values = [
        //     {
        //         name:'one',
        //         type:'line',
        //         data:["80", "20", "10", "100", "90", "20", "20"]
        //     },
        //     {
        //         name: 'two',
        //         type: 'line',
        //         data:['30','40','130','70','110','20','40']
        //     }
        // ];
        // var datex = ['周一','周二','周三','周四','周五','周六','周日'];


        var keys = ["41.Melissa", "42.谢惠丹"];
        var values = [
            {data: [302, 310, 303, 316, 322], name: "41.Melissa", type: "line",
                markLine: {
                    data: [
                        {type: 'average', yAxis: 420, value: '7:00'}
                    ]
                }},
            {data: [406, 420, 407, 420, 422], name: "42.谢惠丹", type: "line",
                markLine: {
                    data: [
                        {name: '3分线', yAxis: 420, value: '7:00'}
                    ]
                }}
        ]
        var datex = ["20180108", "20180109", "20180110", "20180111", "20180112"];

        // init(keys, values, datex);

    })



</script>
</body>
</html>